<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ’± FX í™˜ìœ¨ AI ì°¨íŠ¸ ë¶„ì„ íŠ¸ë ˆì´ë”© ê°€ì´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
            min-height: 100vh;
            color: #ffffff;
            padding: 15px;
            padding-bottom: 100px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* í—¤ë” */
        .header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 15px;
        }
        
        .header h1 {
            font-size: 1.3rem;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #00d4ff, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .subtitle {
            font-size: 0.85rem;
            color: #8892b0;
        }
        
        .clock-box {
            background: #141428;
            border-radius: 15px;
            padding: 12px;
            margin-top: 12px;
        }
        
        .clock {
            font-size: 1rem;
            color: #00d4ff;
            font-family: 'Consolas', monospace;
            margin-bottom: 6px;
        }
        
        .market-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .market-status.optimal {
            background: rgba(255, 211, 42, 0.2);
            color: #ffd32a;
            border: 1px solid #ffd32a;
            animation: pulse 2s infinite;
        }
        
        .market-status.open {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }
        
        .market-status.closed {
            background: rgba(136, 146, 176, 0.2);
            color: #8892b0;
            border: 1px solid #8892b0;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* API í‚¤ ì„¤ì • */
        .api-setup {
            background: linear-gradient(135deg, #1a1a3a 0%, #2a1a3a 100%);
            border: 1px solid #ff0080;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .api-setup h3 {
            color: #ff0080;
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .api-setup p {
            font-size: 0.8rem;
            color: #8892b0;
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .api-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .api-input-group input {
            flex: 1;
            padding: 12px;
            border: 1px solid #3a3a5a;
            border-radius: 10px;
            background: #141428;
            color: #ffffff;
            font-size: 0.9rem;
        }
        
        .api-input-group input:focus {
            outline: none;
            border-color: #ff0080;
        }
        
        .api-input-group button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #ff0080, #ff4757);
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .api-status.connected {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
        }
        
        .api-status.disconnected {
            background: rgba(255, 71, 87, 0.1);
            color: #ff4757;
        }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            background: #141428;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 15px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: transparent;
            color: #8892b0;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #00d4ff, #0080ff);
            color: #ffffff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ìŠ¤í… ì¹´ë“œ */
        .step-card {
            background: #141428;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #2a2a4a;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #0080ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            margin-right: 12px;
        }
        
        .step-number.chart {
            background: linear-gradient(135deg, #ff0080, #ff4757);
        }
        
        .step-number.ai {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .step-title {
            flex: 1;
        }
        
        .step-title h3 {
            color: #ffffff;
            font-size: 1rem;
            margin-bottom: 3px;
        }
        
        .step-title p {
            color: #8892b0;
            font-size: 0.75rem;
        }
        
        .step-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .step-status.pending {
            background: rgba(136, 146, 176, 0.2);
            color: #8892b0;
        }
        
        .step-status.done {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .step-status.analyzing {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
            animation: pulse 1s infinite;
        }
        
        /* ì°¨íŠ¸ ì—…ë¡œë“œ ì˜ì—­ */
        .chart-upload-area {
            border: 2px dashed #3a3a5a;
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .chart-upload-area:hover {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.05);
        }
        
        .chart-upload-area.has-image {
            padding: 10px;
            border-style: solid;
            border-color: #00ff88;
        }
        
        .chart-upload-area.analyzing {
            border-color: #9b59b6;
            background: rgba(155, 89, 182, 0.05);
        }
        
        .chart-upload-area .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .chart-upload-area .upload-text {
            font-size: 0.95rem;
            color: #ffffff;
            margin-bottom: 8px;
        }
        
        .chart-upload-area .upload-hint {
            font-size: 0.8rem;
            color: #8892b0;
        }
        
        .chart-upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .chart-preview {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .chart-preview-container {
            position: relative;
        }
        
        .remove-chart-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 71, 87, 0.9);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* AI ë¶„ì„ ì§„í–‰ ìƒíƒœ */
        .ai-analysis-status {
            background: linear-gradient(135deg, #1a1a3a 0%, #2a1a4a 100%);
            border: 1px solid #9b59b6;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: none;
        }
        
        .ai-analysis-status.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .ai-analysis-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .ai-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #2a2a4a;
            border-top-color: #9b59b6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .ai-analysis-header h4 {
            color: #9b59b6;
            font-size: 1rem;
        }
        
        .ai-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .ai-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(155, 89, 182, 0.1);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #8892b0;
        }
        
        .ai-step.active {
            color: #9b59b6;
            background: rgba(155, 89, 182, 0.2);
        }
        
        .ai-step.done {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        
        .ai-step .step-icon {
            width: 20px;
            text-align: center;
        }
        
        /* AI ë¶„ì„ ê²°ê³¼ ìë™ ì…ë ¥ í‘œì‹œ */
        .auto-filled {
            position: relative;
        }
        
        .auto-filled::after {
            content: 'ğŸ¤– AI';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            padding: 2px 6px;
            border-radius: 8px;
            color: white;
        }
        
        /* ì°¨íŠ¸ ì†ŒìŠ¤ ì„ íƒ */
        .chart-source-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .chart-source-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #3a3a5a;
            border-radius: 12px;
            background: #1e1e3c;
            color: #8892b0;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .chart-source-btn.active {
            border-color: #00d4ff;
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
        }
        
        .chart-source-btn .icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 5px;
        }
        
        /* íƒ€ì„í”„ë ˆì„ ì„ íƒ */
        .timeframe-section {
            margin-bottom: 15px;
        }
        
        .timeframe-section h4 {
            color: #8892b0;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }
        
        .timeframe-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .timeframe-btn {
            padding: 8px 16px;
            border-radius: 20px;
            background: #1e1e3c;
            border: 1px solid #3a3a5a;
            color: #8892b0;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .timeframe-btn.active {
            background: linear-gradient(135deg, #ff0080, #ff4757);
            border-color: #ff0080;
            color: #ffffff;
        }
        
        /* ê¸°ìˆ ì  ë¶„ì„ ì…ë ¥ */
        .tech-input-section {
            background: #1e1e3c;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .tech-input-section.ai-filled {
            border: 1px solid #9b59b6;
        }
        
        .ai-badge {
            position: absolute;
            top: -10px;
            right: 15px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.7rem;
            color: white;
            display: none;
        }
        
        .tech-input-section.ai-filled .ai-badge {
            display: block;
        }
        
        .tech-input-section h4 {
            color: #ff0080;
            font-size: 0.9rem;
            margin-bottom: 12px;
        }
        
        .tech-input-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #2a2a4a;
        }
        
        .tech-input-row:last-child {
            border-bottom: none;
        }
        
        .tech-input-row label {
            font-size: 0.85rem;
            color: #c0c0c0;
        }
        
        .tech-input-row input, .tech-input-row select {
            width: 120px;
            padding: 8px 12px;
            border: 1px solid #3a3a5a;
            border-radius: 8px;
            background: #141428;
            color: #ffffff;
            font-size: 0.95rem;
            text-align: right;
        }
        
        .tech-input-row input:focus, .tech-input-row select:focus {
            outline: none;
            border-color: #00d4ff;
        }
        
        .tech-input-row input.ai-value {
            border-color: #9b59b6;
            background: rgba(155, 89, 182, 0.1);
        }
        
        /* ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ */
        .fetch-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            margin-bottom: 12px;
        }
        
        .fetch-btn.investing {
            background: linear-gradient(135deg, #1a3a1a 0%, #0a2a0a 100%);
            border: 2px solid #00ff88;
            color: #00ff88;
        }
        
        .fetch-btn.barchart {
            background: linear-gradient(135deg, #1a1a3a 0%, #0a0a2a 100%);
            border: 2px solid #00d4ff;
            color: #00d4ff;
        }
        
        .fetch-btn:active {
            transform: scale(0.98);
        }
        
        .fetch-btn .icon {
            font-size: 1.3rem;
        }
        
        /* ì…ë ¥ í•„ë“œ */
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #1e1e3c;
            border-radius: 12px;
            padding: 12px 15px;
        }
        
        .input-row label {
            font-size: 0.85rem;
            color: #8892b0;
            white-space: nowrap;
        }
        
        .input-row input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: #141428;
            color: #ffffff;
            font-size: 1.2rem;
            text-align: right;
            font-weight: bold;
        }
        
        .input-row input:focus {
            outline: 2px solid #00d4ff;
        }
        
        .input-row .unit {
            font-size: 0.9rem;
            color: #8892b0;
        }
        
        /* ë„ì›€ë§ */
        .help-text {
            background: rgba(255, 211, 42, 0.1);
            border: 1px solid rgba(255, 211, 42, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-top: 12px;
            font-size: 0.8rem;
            color: #ffd32a;
            line-height: 1.5;
        }
        
        .help-text strong {
            color: #ffffff;
        }
        
        .help-text.ai {
            background: rgba(155, 89, 182, 0.1);
            border-color: rgba(155, 89, 182, 0.3);
            color: #9b59b6;
        }
        
        /* íˆ¬ìê¸ˆ ì…ë ¥ */
        .invest-section {
            background: #141428;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #2a2a4a;
        }
        
        .invest-section h4 {
            color: #8892b0;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }
        
        .invest-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .invest-option {
            padding: 8px 15px;
            border-radius: 20px;
            background: #1e1e3c;
            border: 1px solid #3a3a5a;
            color: #8892b0;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .invest-option.active {
            background: linear-gradient(135deg, #00d4ff, #0080ff);
            border-color: #00d4ff;
            color: #ffffff;
        }
        
        .invest-option:active {
            transform: scale(0.95);
        }
        
        .invest-custom {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .invest-custom input {
            flex: 1;
            padding: 10px;
            border: 1px solid #3a3a5a;
            border-radius: 8px;
            background: #1e1e3c;
            color: #ffffff;
            font-size: 1rem;
            text-align: right;
        }
        
        .invest-custom input:focus {
            outline: none;
            border-color: #00d4ff;
        }
        
        .invest-custom span {
            color: #8892b0;
            font-size: 0.9rem;
        }
        
        /* ë¶„ì„ ë²„íŠ¼ */
        .analyze-btn {
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 15px;
            background: linear-gradient(90deg, #ff0080, #ff4757);
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(255, 0, 128, 0.4);
            transition: all 0.3s;
        }
        
        .analyze-btn:active {
            transform: scale(0.98);
        }
        
        .analyze-btn:disabled {
            background: linear-gradient(90deg, #4a4a6a, #3a3a5a);
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .analyze-btn .sub-text {
            font-size: 0.8rem;
            font-weight: normal;
            opacity: 0.8;
            display: block;
            margin-top: 5px;
        }
        
        .analyze-btn.ai {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
            box-shadow: 0 5px 20px rgba(155, 89, 182, 0.4);
        }
        
        /* ë¡œë”© */
        .loading {
            display: none;
            text-align: center;
            padding: 50px 20px;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #2a2a4a;
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        .loading-text {
            color: #8892b0;
            font-size: 0.9rem;
        }
        
        .loading-steps {
            margin-top: 20px;
            text-align: left;
            background: #1e1e3c;
            border-radius: 12px;
            padding: 15px;
        }
        
        .loading-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.85rem;
            color: #8892b0;
        }
        
        .loading-step.active {
            color: #00d4ff;
        }
        
        .loading-step.done {
            color: #00ff88;
        }
        
        .loading-step .check {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid currentColor;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        
        .loading-step.done .check {
            background: #00ff88;
            border-color: #00ff88;
            color: #0a0a1a;
        }
        
        /* ==================== ê²°ê³¼ ì˜ì—­ ==================== */
        .result-area {
            display: none;
        }
        
        .result-area.show {
            display: block;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ë¶„ì„ íƒ€ì… ë±ƒì§€ */
        .analysis-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }
        
        .analysis-type-badge.ndf {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            border: 1px solid #00d4ff;
        }
        
        .analysis-type-badge.chart {
            background: rgba(255, 0, 128, 0.2);
            color: #ff0080;
            border: 1px solid #ff0080;
        }
        
        .analysis-type-badge.ai-chart {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
            border: 1px solid #9b59b6;
        }
        
        .analysis-type-badge.combined {
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.2), rgba(255, 0, 128, 0.2));
            color: #ffffff;
            border: 1px solid #8892b0;
        }
        
        /* ë©”ì¸ ì‹œê·¸ë„ */
        .main-signal {
            border-radius: 25px;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .main-signal.sell-krw {
            background: linear-gradient(135deg, #0a2a1a 0%, #0a1a0a 100%);
            border: 2px solid #00ff88;
        }
        
        .main-signal.buy-krw {
            background: linear-gradient(135deg, #2a0a1a 0%, #1a0a0a 100%);
            border: 2px solid #ff4757;
        }
        
        .main-signal.hold {
            background: linear-gradient(135deg, #2a2a0a 0%, #1a1a0a 100%);
            border: 2px solid #ffd32a;
        }
        
        .signal-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            margin-bottom: 15px;
        }
        
        .main-signal.sell-krw .signal-badge { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .main-signal.buy-krw .signal-badge { background: rgba(255, 71, 87, 0.2); color: #ff4757; }
        .main-signal.hold .signal-badge { background: rgba(255, 211, 42, 0.2); color: #ffd32a; }
        
        .signal-icon { font-size: 4rem; margin-bottom: 10px; }
        .signal-title { font-size: 2rem; font-weight: bold; margin-bottom: 8px; }
        
        .main-signal.sell-krw .signal-title { color: #00ff88; }
        .main-signal.buy-krw .signal-title { color: #ff4757; }
        .main-signal.hold .signal-title { color: #ffd32a; }
        
        .signal-desc { font-size: 1.1rem; color: #e0e0e0; margin-bottom: 20px; }
        
        .confidence-section { margin-top: 20px; }
        .confidence-label { font-size: 0.85rem; color: #8892b0; margin-bottom: 8px; }
        
        .confidence-bar-bg {
            background: rgba(255,255,255,0.1);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .confidence-bar-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 1s ease;
        }
        
        .main-signal.sell-krw .confidence-bar-fill { background: linear-gradient(90deg, #00ff88, #00d4aa); }
        .main-signal.buy-krw .confidence-bar-fill { background: linear-gradient(90deg, #ff4757, #ff6b7a); }
        .main-signal.hold .confidence-bar-fill { background: linear-gradient(90deg, #ffd32a, #ffdd55); }
        
        .confidence-value { font-size: 1.1rem; font-weight: bold; color: #ffffff; }
        
        /* ë³µí•© ì‹ ë¢°ë„ */
        .confidence-breakdown {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .confidence-item {
            flex: 1;
            text-align: center;
        }
        
        .confidence-item-label {
            font-size: 0.7rem;
            color: #8892b0;
            margin-bottom: 5px;
        }
        
        .confidence-item-value {
            font-size: 1rem;
            font-weight: bold;
        }
        
        .confidence-item-value.ndf { color: #00d4ff; }
        .confidence-item-value.chart { color: #ff0080; }
        .confidence-item-value.ai { color: #9b59b6; }
        
        /* AI ë¶„ì„ ê²°ê³¼ ë°•ìŠ¤ */
        .ai-result-box {
            background: linear-gradient(135deg, #1a1a3a 0%, #2a1a4a 100%);
            border: 1px solid #9b59b6;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .ai-result-box h3 {
            color: #9b59b6;
            font-size: 1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-insight {
            background: rgba(155, 89, 182, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
        }
        
        .ai-insight-title {
            font-size: 0.85rem;
            color: #9b59b6;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .ai-insight-text {
            font-size: 0.85rem;
            color: #c0c0c0;
            line-height: 1.5;
        }
        
        /* ì°¨íŠ¸ ë¶„ì„ ê²°ê³¼ */
        .chart-analysis-result {
            background: #141428;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #ff0080;
        }
        
        .chart-analysis-result h3 {
            color: #ff0080;
            font-size: 1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pattern-detected {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .pattern-tag {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .pattern-tag.bullish {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }
        
        .pattern-tag.bearish {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid #ff4757;
        }
        
        .pattern-tag.neutral {
            background: rgba(255, 211, 42, 0.2);
            color: #ffd32a;
            border: 1px solid #ffd32a;
        }
        
        .level-list {
            margin-top: 15px;
        }
        
        .level-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: #1e1e3c;
            border-radius: 10px;
            margin-bottom: 8px;
        }
        
        .level-item .level-type {
            font-size: 0.85rem;
            color: #8892b0;
        }
        
        .level-item .level-value {
            font-size: 1rem;
            font-weight: bold;
        }
        
        .level-item .level-value.resistance { color: #ff4757; }
        .level-item .level-value.support { color: #00ff88; }
        .level-item .level-value.current { color: #00d4ff; }
        
        /* ê°€ê²© ê°€ì´ë“œ */
        .price-guide {
            background: #141428;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #2a2a4a;
        }
        
        .price-guide h3 {
            color: #00d4ff;
            font-size: 1.1rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #1e1e3c;
            border-radius: 12px;
            margin-bottom: 10px;
        }
        
        .price-item:last-child { margin-bottom: 0; }
        
        .price-label {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .price-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }
        
        .price-icon.entry { background: rgba(0, 212, 255, 0.2); }
        .price-icon.target { background: rgba(0, 255, 136, 0.2); }
        .price-icon.stop { background: rgba(255, 71, 87, 0.2); }
        
        .price-text .main-label {
            font-size: 0.9rem;
            color: #ffffff;
            font-weight: 600;
        }
        
        .price-text .sub-label {
            font-size: 0.75rem;
            color: #8892b0;
        }
        
        .price-value { text-align: right; }
        .price-value .amount { font-size: 1.4rem; font-weight: bold; color: #ffffff; }
        .price-value .change { font-size: 0.8rem; }
        .price-value .change.positive { color: #00ff88; }
        .price-value .change.negative { color: #ff4757; }
        
        /* ë¶„ì„ ê·¼ê±° í‘œì‹œ */
        .price-basis {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .basis-tag {
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 8px;
        }
        
        .basis-tag.ndf {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }
        
        .basis-tag.chart {
            background: rgba(255, 0, 128, 0.2);
            color: #ff0080;
        }
        
        .basis-tag.ai {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
        }
        
        /* ìˆ˜ìµ/ì†ì‹¤ ì¹´ë“œ */
        .profit-loss-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .profit-card, .loss-card {
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .profit-card {
            background: linear-gradient(135deg, #0a2a1a 0%, #0a1a0a 100%);
            border: 1px solid #00ff88;
        }
        
        .loss-card {
            background: linear-gradient(135deg, #2a0a1a 0%, #1a0a0a 100%);
            border: 1px solid #ff4757;
        }
        
        .profit-card h4 { color: #00ff88; font-size: 0.8rem; margin-bottom: 10px; }
        .loss-card h4 { color: #ff4757; font-size: 0.8rem; margin-bottom: 10px; }
        
        .profit-amount { font-size: 1.5rem; font-weight: bold; color: #00ff88; }
        .loss-amount { font-size: 1.5rem; font-weight: bold; color: #ff4757; }
        
        .profit-desc, .loss-desc { font-size: 0.75rem; color: #8892b0; margin-top: 5px; }
        
        /* ë¦¬ìŠ¤í¬/ë¦¬ì›Œë“œ ë¹„ìœ¨ */
        .rr-ratio {
            background: #141428;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #2a2a4a;
        }
        
        .rr-ratio h4 {
            color: #8892b0;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }
        
        .rr-value {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(90deg, #00d4ff, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .rr-desc {
            font-size: 0.8rem;
            color: #8892b0;
            margin-top: 8px;
        }
        
        /* ì „ëµ ì„¹ì…˜ */
        .strategy-section {
            background: #141428;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #2a2a4a;
        }
        
        .strategy-section h3 {
            color: #ff0080;
            font-size: 1.1rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .strategy-item {
            display: flex;
            padding: 15px 0;
            border-bottom: 1px solid #2a2a4a;
        }
        
        .strategy-item:last-child { border-bottom: none; }
        
        .strategy-num {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff0080, #ff4757);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .strategy-content { flex: 1; }
        .strategy-title { font-size: 0.95rem; color: #ffffff; font-weight: 600; margin-bottom: 5px; }
        .strategy-desc { font-size: 0.8rem; color: #8892b0; line-height: 1.5; }
        
        /* ë°ì´í„° ìš”ì•½ */
        .data-summary {
            background: #141428;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2a2a4a;
        }
        
        .data-summary h3 {
            color: #00d4ff;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #2a2a4a;
            font-size: 0.9rem;
        }
        
        .data-row:last-child { border-bottom: none; }
        .data-label { color: #8892b0; }
        .data-value { color: #ffffff; font-weight: 600; }
        .data-value.up { color: #00ff88; }
        .data-value.down { color: #ff4757; }
        
        /* ì£¼ì˜ì‚¬í•­ */
        .warning-box {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid #ff4757;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .warning-box h4 {
            color: #ff4757;
            font-size: 0.9rem;
            margin-bottom: 12px;
        }
        
        .warning-list {
            list-style: none;
        }
        
        .warning-list li {
            font-size: 0.8rem;
            color: #c0c0c0;
            padding: 6px 0;
            padding-left: 22px;
            position: relative;
            line-height: 1.4;
        }
        
        .warning-list li::before {
            content: âš ï¸';
            position: absolute;
            left: 0;
            font-size: 0.7rem;
        }
        
        /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ */
        .reset-btn {
            width: 100%;
            padding: 15px;
            border: 2px solid #3a3a5a;
            border-radius: 12px;
            background: transparent;
            color: #8892b0;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .reset-btn:active {
            background: #1e1e3c;
        }
        
        /* í‘¸í„° */
        .footer {
            text-align: center;
            padding: 20px;
            color: #8892b0;
            font-size: 0.7rem;
        }
    </style>
</head>
<body>
    <div class="container">
        
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸ’± FX í™˜ìœ¨ AI ì°¨íŠ¸ ë¶„ì„ ê°€ì´ë“œ</h1>
            <p class="subtitle">ì°¨íŠ¸ ì—…ë¡œë“œ â†’ AI ìë™ ë¶„ì„ â†’ ë§¤ë§¤ í¬ì¸íŠ¸!</p>
            
            <div class="clock-box">
                <div class="clock" id="clock">ğŸ‡°ğŸ‡· 2026-01-12 13:55:00</div>
                <div class="market-status" id="marketStatus">ğŸŸ¢ í•œêµ­ ì‹œì¥ ê±°ë˜ ì¤‘</div>
            </div>
        </header>
        
        <!-- API í‚¤ ì„¤ì • -->
        <div class="api-setup" id="apiSetup">
            <h3>ğŸ”‘ AI ë¶„ì„ API ì„¤ì •</h3>
            <p>ì°¨íŠ¸ ìë™ ë¶„ì„ì„ ìœ„í•´ OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.<br>
            <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #00d4ff;">OpenAI API í‚¤ ë°œê¸‰ë°›ê¸° â†’</a></p>
            
            <div class="api-input-group">
                <input type="password" id="apiKeyInput" placeholder="sk-..." autocomplete="off">
                <button onclick="saveApiKey()">ì €ì¥</button>
            </div>
            
            <div class="api-status disconnected" id="apiStatus">
                <span>ğŸ”´</span>
                <span>API í‚¤ ë¯¸ì„¤ì •</span>
            </div>
        </div>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('ndf')">ğŸ“Š NDF</button>
            <button class="tab-btn" onclick="switchTab('chart')">ğŸ¤– AI ì°¨íŠ¸</button>
            <button class="tab-btn" onclick="switchTab('combined')">ğŸ”¥ ë³µí•©</button>
        </div>
        
        <!-- ==================== NDF ë¶„ì„ íƒ­ ==================== -->
        <div class="tab-content active" id="tab-ndf">
            
            <!-- STEP 1: ì „ì¼ ì¢…ê°€ -->
            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">
                        <h3>ğŸ“Š ì „ì¼ ì¢…ê°€ ê°€ì ¸ì˜¤ê¸°</h3>
                        <p>Investing.comì—ì„œ ì–´ì œ ë§ˆê°ê°€ í™•ì¸</p>
                    </div>
                    <div class="step-status pending" id="step1Status">ëŒ€ê¸°ì¤‘</div>
                </div>
                
                <button class="fetch-btn investing" onclick="openInvesting()">
                    <span class="icon">ğŸ“Š</span>
                    <span>Investing.com ì—´ê¸° â†’ ì¢…ê°€ í™•ì¸</span>
                </button>
                
                <div class="input-row">
                    <label>ì „ì¼ ì¢…ê°€</label>
                    <input type="number" id="prevClose" placeholder="1438.50" step="0.01" inputmode="decimal" onchange="checkStep1()">
                    <span class="unit">ì›</span>
                </div>
                
                <div class="help-text">
                    ğŸ’¡ <strong>ì°¾ëŠ” ë°©ë²•:</strong> í˜ì´ì§€ ìƒë‹¨ì˜ <strong>"ì¢…ê°€"</strong> ë˜ëŠ” <strong>"ì´ì „ ì¢…ê°€"</strong> ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”!
                </div>
            </div>
            
            <!-- STEP 2: NDF í™˜ìœ¨ -->
            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">
                        <h3>ğŸŒ™ í˜„ì¬ NDF ê°€ì ¸ì˜¤ê¸°</h3>
                        <p>Barchartì—ì„œ ì—­ì™¸í™˜ìœ¨ í™•ì¸</p>
                    </div>
                    <div class="step-status pending" id="step2Status">ëŒ€ê¸°ì¤‘</div>
                </div>
                
                <button class="fetch-btn barchart" onclick="openBarchart()">
                    <span class="icon">ğŸ“ˆ</span>
                    <span>Barchart ì—´ê¸° â†’ NDF í™•ì¸</span>
                </button>
                
                <div class="input-row">
                    <label>NDF í˜„ì¬ê°€</label>
                    <input type="number" id="ndfRate" placeholder="1455.20" step="0.01" inputmode="decimal" onchange="checkStep2()">
                    <span class="unit">ì›</span>
                </div>
                
                <div class="help-text">
                    ğŸ’¡ <strong>ì°¾ëŠ” ë°©ë²•:</strong> í˜ì´ì§€ <strong>ìƒë‹¨ì˜ ê°€ì¥ í° ìˆ«ì</strong>ê°€ í˜„ì¬ NDFì…ë‹ˆë‹¤!
                </div>
            </div>
            
            <!-- íˆ¬ìê¸ˆ -->
            <div class="invest-section">
                <h4>ğŸ’° íˆ¬ì ì˜ˆì • ê¸ˆì•¡ (ì„ íƒì‚¬í•­)</h4>
                
                <div class="invest-options">
                    <div class="invest-option" onclick="setInvestment(500000, this)">50ë§Œì›</div>
                    <div class="invest-option active" onclick="setInvestment(1000000, this)">100ë§Œì›</div>
                    <div class="invest-option" onclick="setInvestment(3000000, this)">300ë§Œì›</div>
                    <div class="invest-option" onclick="setInvestment(5000000, this)">500ë§Œì›</div>
                </div>
                
                <div class="invest-custom">
                    <span>ì§ì ‘ ì…ë ¥:</span>
                    <input type="number" id="investment" value="1000000" step="100000" inputmode="numeric">
                    <span>ì›</span>
                </div>
            </div>
            
            <!-- ë¶„ì„ ë²„íŠ¼ -->
            <button class="analyze-btn" id="analyzeBtnNdf" onclick="analyzeNdf()" disabled>
                ğŸš€ NDF ê¸°ë°˜ ë§¤ë§¤ ê°€ì´ë“œ ë°›ê¸°
                <span class="sub-text">ì „ì¼ ì¢…ê°€ì™€ NDFë¥¼ ì…ë ¥í•˜ë©´ ë¶„ì„í•´ë“œë ¤ìš”!</span>
            </button>
        </div>
        
        <!-- ==================== AI ì°¨íŠ¸ ë¶„ì„ íƒ­ ==================== -->
        <div class="tab-content" id="tab-chart">
            
            <!-- ì°¨íŠ¸ ì—…ë¡œë“œ -->
            <div class="step-card">
                <div class="step-header">
                    <div class="step-number ai">1</div>
                    <div class="step-title">
                        <h3>ğŸ“¸ ì°¨íŠ¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ</h3>
                        <p>ì—…ë¡œë“œí•˜ë©´ AIê°€ ìë™ ë¶„ì„í•´ìš”!</p>
                    </div>
                    <div class="step-status pending" id="chartUploadStatus">ëŒ€ê¸°ì¤‘</div>
                </div>
                
                <!-- ì°¨íŠ¸ ì†ŒìŠ¤ ì„ íƒ -->
                <div class="chart-source-options">
                    <button class="chart-source-btn active" onclick="selectChartSource('investing', this)">
                        <span class="icon">ğŸ“Š</span>
                        Investing
                    </button>
                    <button class="chart-source-btn" onclick="selectChartSource('tradingview', this)">
                        <span class="icon">ğŸ“ˆ</span>
                        TradingView
                    </button>
                    <button class="chart-source-btn" onclick="selectChartSource('other', this)">
                        <span class="icon">ğŸ“±</span>
                        ê¸°íƒ€
                    </button>
                </div>
                
                <!-- ì—…ë¡œë“œ ì˜ì—­ -->
                <div class="chart-upload-area" id="chartUploadArea">
                    <div class="upload-icon">ğŸ¤–</div>
                    <div class="upload-text">ì°¨íŠ¸ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                    <div class="upload-hint">AIê°€ ìë™ìœ¼ë¡œ ì§€ì§€ì„ /ì €í•­ì„ ì„ ë¶„ì„í•©ë‹ˆë‹¤<br>(PNG, JPG, WEBP)</div>
                    <input type="file" id="chartFileInput" accept="image/*" onchange="handleChartUpload(event)">
                </div>
                
                <!-- ì°¨íŠ¸ ë¯¸ë¦¬ë³´ê¸° -->
                <div class="chart-preview-container" id="chartPreviewContainer" style="display: none;">
                    <img id="chartPreview" class="chart-preview" src="" alt="ì°¨íŠ¸ ë¯¸ë¦¬ë³´ê¸°">
                    <button class="remove-chart-btn" onclick="removeChart()">Ã—</button>
                </div>
                
                <div class="help-text ai">
                    ğŸ¤– <strong>AI ìë™ ë¶„ì„:</strong> ì°¨íŠ¸ë¥¼ ì—…ë¡œë“œí•˜ë©´ GPT-4 Visionì´ ìë™ìœ¼ë¡œ ì§€ì§€ì„ , ì €í•­ì„ , ì¶”ì„¸, íŒ¨í„´ì„ ë¶„ì„í•´ìš”!
                </div>
            </div>
            
            <!-- AI ë¶„ì„ ì§„í–‰ ìƒíƒœ -->
            <div class="ai-analysis-status" id="aiAnalysisStatus">
                <div class="ai-analysis-header">
                    <div class="ai-spinner"></div>
                    <h4>AIê°€ ì°¨íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ìˆì–´ìš”...</h4>
                </div>
                <div class="ai-steps">
                    <div class="ai-step" id="aiStep1">
                        <span class="step-icon">1</span>
                        <span>ì´ë¯¸ì§€ ì¸ì‹ ì¤‘...</span>
                    </div>
                    <div class="ai-step" id="aiStep2">
                        <span class="step-icon">2</span>
                        <span>ìº”ë“¤ íŒ¨í„´ ë¶„ì„ ì¤‘...</span>
                    </div>
                    <div class="ai-step" id="aiStep3">
                        <span class="step-icon">3</span>
                        <span>ì§€ì§€ì„ /ì €í•­ì„  íƒì§€ ì¤‘...</span>
                    </div>
                    <div class="ai-step" id="aiStep4">
                        <span class="step-icon">4</span>
                        <span>ì¶”ì„¸ ë° ì‹œê·¸ë„ íŒë‹¨ ì¤‘...</span>
                    </div>
                </div>
            </div>
            
            <!-- íƒ€ì„í”„ë ˆì„ ì„ íƒ -->
            <div class="step-card">
                <div class="step-header">
                    <div class="step-number ai">2</div>
                    <div class="step-title">
                        <h3>â° ì°¨íŠ¸ íƒ€ì„í”„ë ˆì„</h3>
                        <p>ì—…ë¡œë“œí•œ ì°¨íŠ¸ì˜ ì‹œê°„ ë‹¨ìœ„ ì„ íƒ</p>
                    </div>
                </div>
                
                <div class="timeframe-options">
                    <button class="timeframe-btn" onclick="setTimeframe('5m', this)">5ë¶„</button>
                    <button class="timeframe-btn" onclick="setTimeframe('15m', this)">15ë¶„</button>
                    <button class="timeframe-btn" onclick="setTimeframe('1h', this)">1ì‹œê°„</button>
                    <button class="timeframe-btn active" onclick="setTimeframe('4h', this)">4ì‹œê°„</button>
                    <button class="timeframe-btn" onclick="setTimeframe('1d', this)">ì¼ë´‰</button>
                    <button class="timeframe-btn" onclick="setTimeframe('1w', this)">ì£¼ë´‰</button>
                </div>
            </div>
            
            <!-- AI ë¶„ì„ ê²°ê³¼ (ìë™ ì…ë ¥) -->
            <div class="step-card" id="aiResultCard" style="display: none;">
                <div class="step-header">
                    <div class="step-number ai">3</div>
                    <div class="step-title">
                        <h3>ğŸ¤– AI ë¶„ì„ ê²°ê³¼</h3>
                        <p>ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆì–´ìš”!</p>
                    </div>
                    <div class="step-status done">ì™„ë£Œ âœ“</div>
                </div>
                
                <div class="tech-input-section ai-filled">
                    <div class="ai-badge">ğŸ¤– AI ìë™ ì…ë ¥</div>
                    <h4>ğŸ“ AIê°€ ê°ì§€í•œ ê°€ê²© ë ˆë²¨</h4>
                    <div class="tech-input-row">
                        <label>í˜„ì¬ê°€</label>
                        <input type="number" id="chartCurrentPrice" class="ai-value" readonly>
                    </div>
                    <div class="tech-input-row">
                        <label>1ì°¨ ì €í•­ì„ </label>
                        <input type="number" id="chartResistance1" class="ai-value" readonly>
                    </div>
                    <div class="tech-input-row">
                        <label>2ì°¨ ì €í•­ì„ </label>
                        <input type="number" id="chartResistance2" class="ai-value" readonly>
                    </div>
                    <div class="tech-input-row">
                        <label>1ì°¨ ì§€ì§€ì„ </label>
                        <input type="number" id="chartSupport1" class="ai-value" readonly>
                    </div>
                    <div class="tech-input-row">
                        <label>2ì°¨ ì§€ì§€ì„ </label>
                        <input type="number" id="chartSupport2" class="ai-value" readonly>
                    </div>
                </div>
                
                <div class="tech-input-section ai-filled">
                    <div class="ai-badge">ğŸ¤– AI ìë™ ì…ë ¥</div>
                    <h4>ğŸ“Š AIê°€ ê°ì§€í•œ ê¸°ìˆ ì  ì§€í‘œ</h4>
                    <div class="tech-input-row">
                        <label>RSI ì¶”ì •</label>
                        <input type="number" id="chartRsi" class="ai-value" readonly>
                    </div>
                    <div class="tech-input-row">
                        <label>ì¶”ì„¸ ë°©í–¥</label>
                        <input type="text" id="chartTrend" class="ai-value" readonly>
                    </div>
                    <div class="tech-input-row">
                        <label>ê°ì§€ëœ íŒ¨í„´</label>
                        <input type="text" id="chartPatterns" class="ai-value" readonly style="width: 180px; font-size: 0.8rem;">
                    </div>
                </div>
                
                <!-- AI ì½”ë©˜íŠ¸ -->
                <div class="ai-insight" id="aiComment">
                    <div class="ai-insight-title">ğŸ’¬ AI ë¶„ì„ ì½”ë©˜íŠ¸</div>
                    <div class="ai-insight-text" id="aiCommentText">
                        ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
            
            <!-- ìˆ˜ë™ ìˆ˜ì • ì˜µì…˜ -->
            <div class="step-card" id="manualEditCard" style="display: none;">
                <div class="step-header">
                    <div class="step-number chart">âœï¸</div>
                    <div class="step-title">
                        <h3>ìˆ˜ë™ ìˆ˜ì • (ì„ íƒì‚¬í•­)</h3>
                        <p>AI ê²°ê³¼ë¥¼ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ìš”</p>
                    </div>
                </div>
                
                <button class="fetch-btn barchart" onclick="enableManualEdit()">
                    <span class="icon">âœï¸</span>
                    <span>AI ê²°ê³¼ ì§ì ‘ ìˆ˜ì •í•˜ê¸°</span>
                </button>
            </div>
            
            <!-- íˆ¬ìê¸ˆ -->
            <div class="invest-section">
                <h4>ğŸ’° íˆ¬ì ì˜ˆì • ê¸ˆì•¡ (ì„ íƒì‚¬í•­)</h4>
                <div class="invest-options">
                    <div class="invest-option" onclick="setInvestment(500000, this)">50ë§Œì›</div>
                    <div class="invest-option active" onclick="setInvestment(1000000, this)">100ë§Œì›</div>
                    <div class="invest-option" onclick="setInvestment(3000000, this)">300ë§Œì›</div>
                    <div class="invest-option" onclick="setInvestment(5000000, this)">500ë§Œì›</div>
                </div>
                <div class="invest-custom">
                    <span>ì§ì ‘ ì…ë ¥:</span>
                    <input type="number" id="investmentChart" value="1000000" step="100000" inputmode="numeric">
                    <span>ì›</span>
                </div>
            </div>
            
            <!-- ë¶„ì„ ë²„íŠ¼ -->
            <button class="analyze-btn ai" id="analyzeBtnChart" onclick="finalizeChartAnalysis()" disabled>
                ğŸ¤– AI ì°¨íŠ¸ ë¶„ì„ ê²°ê³¼ë¡œ ë§¤ë§¤ ê°€ì´ë“œ ë°›ê¸°
                <span class="sub-text">ì°¨íŠ¸ë¥¼ ì—…ë¡œë“œí•˜ë©´ AIê°€ ìë™ ë¶„ì„í•´ìš”!</span>
            </button>
        </div>
        
        <!-- ==================== ë³µí•© ë¶„ì„ íƒ­ ==================== -->
        <div class="tab-content" id="tab-combined">
            
            <div class="step-card" style="border-color: #ff0080;">
                <div class="step-header">
                    <div class="step-number" style="background: linear-gradient(135deg, #00d4ff, #ff0080);">â˜…</div>
                    <div class="step-title">
                        <h3>ğŸ”¥ NDF + AI ì°¨íŠ¸ ë³µí•© ë¶„ì„</h3>
                        <p>ë‘ ê°€ì§€ ë¶„ì„ì„ ê²°í•©í•œ ìµœê°• ì‹œê·¸ë„</p>
                    </div>
                </div>
                
                <div style="text-align: center; padding: 20px 0;">
                    <p style="color: #8892b0; font-size: 0.9rem; margin-bottom: 15px;">
                        NDF ë¶„ì„ê³¼ AI ì°¨íŠ¸ ë¶„ì„ì„ <strong style="color: #ff0080;">ëª¨ë‘ ì™„ë£Œ</strong>í•œ í›„<br>
                        ë³µí•© ì‹œê·¸ë„ì„ ë°›ì•„ë³´ì„¸ìš”!
                    </p>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div id="ndfCheckIcon" style="font-size: 2rem;">â¬œ</div>
                            <div style="font-size: 0.8rem; color: #8892b0;">NDF ë¶„ì„</div>
                        </div>
                        <div style="font-size: 2rem; color: #3a3a5a;">+</div>
                        <div style="text-align: center;">
                            <div id="chartCheckIcon" style="font-size: 2rem;">â¬œ</div>
                            <div style="font-size: 0.8rem; color: #8892b0;">AI ì°¨íŠ¸</div>
                        </div>
                        <div style="font-size: 2rem; color: #3a3a5a;">=</div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem;">ğŸ”¥</div>
                            <div style="font-size: 0.8rem; color: #ff0080;">ë³µí•© ì‹œê·¸ë„</div>
                        </div>
                    </div>
                </div>
                
                <button class="analyze-btn" id="analyzeBtnCombined" onclick="analyzeCombined()" disabled>
                    ğŸ”¥ ë³µí•© ë¶„ì„ ì‹œì‘
                    <span class="sub-text">NDFì™€ AI ì°¨íŠ¸ ë¶„ì„ì„ ë¨¼ì € ì™„ë£Œí•˜ì„¸ìš”</span>
                </button>
            </div>
            
            <div class="help-text" style="background: rgba(255, 0, 128, 0.1); border-color: rgba(255, 0, 128, 0.3); color: #ff0080;">
                ğŸ’¡ <strong>ë³µí•© ë¶„ì„ì˜ ì¥ì :</strong><br>
                â€¢ NDF ê°­ ë°©í–¥ + AI ì°¨íŠ¸ íŒ¨í„´ ë°©í–¥ ì¼ì¹˜ ì‹œ ì‹ ë¢°ë„ UP<br>
                â€¢ AIê°€ ê°ì§€í•œ ì§€ì§€/ì €í•­ì„ ìœ¼ë¡œ ì •ë°€í•œ ì§„ì…ê°€ ì‚°ì¶œ<br>
                â€¢ ë¦¬ìŠ¤í¬/ë¦¬ì›Œë“œ ë¹„ìœ¨ ìë™ ìµœì í™”
            </div>
        </div>
        
        <!-- ë¡œë”© -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p class="loading-text">ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
            <div class="loading-steps" id="loadingSteps">
                <div class="loading-step" id="loadStep1">
                    <div class="check">1</div>
                    <span>ë°ì´í„° ê²€ì¦ ì¤‘...</span>
                </div>
                <div class="loading-step" id="loadStep2">
                    <div class="check">2</div>
                    <span>íŒ¨í„´ ë¶„ì„ ì¤‘...</span>
                </div>
                <div class="loading-step" id="loadStep3">
                    <div class="check">3</div>
                    <span>ë§¤ë§¤ í¬ì¸íŠ¸ ê³„ì‚° ì¤‘...</span>
                </div>
                <div class="loading-step" id="loadStep4">
                    <div class="check">4</div>
                    <span>ì „ëµ ìƒì„± ì¤‘...</span>
                </div>
            </div>
        </div>
        
        <!-- ==================== ê²°ê³¼ ì˜ì—­ ==================== -->
        <div class="result-area" id="resultArea">
            
            <!-- ë¶„ì„ íƒ€ì… ë±ƒì§€ -->
            <div style="text-align: center;">
                <div class="analysis-type-badge ndf" id="analysisTypeBadge">
                    <span>ğŸ“Š</span>
                    <span>NDF ê¸°ë°˜ ë¶„ì„</span>
                </div>
            </div>
            
            <!-- ë©”ì¸ ì‹œê·¸ë„ -->
            <div class="main-signal" id="mainSignal">
                <div class="signal-badge" id="signalBadge">ì˜¤ëŠ˜ì˜ ì¶”ì²œ</div>
                <div class="signal-icon" id="signalIcon">ğŸŸ¢</div>
                <div class="signal-title" id="signalTitle">ì›í™” ë§¤ë„</div>
                <div class="signal-desc" id="signalDesc">ë‹¬ëŸ¬ë¥¼ ì‚¬ì„¸ìš”! í™˜ìœ¨ ìƒìŠ¹ ì˜ˆìƒ</div>
                
                <div class="confidence-section">
                    <div class="confidence-label">ì‹œê·¸ë„ ì‹ ë¢°ë„</div>
                    <div class="confidence-bar-bg">
                        <div class="confidence-bar-fill" id="confidenceFill" style="width: 0%"></div>
                    </div>
                    <div class="confidence-value" id="confidenceValue">85%</div>
                </div>
                
                <!-- ë³µí•© ë¶„ì„ ì‹œ ì‹ ë¢°ë„ ë¶„í•´ -->
                <div class="confidence-breakdown" id="confidenceBreakdown" style="display: none;">
                    <div class="confidence-item">
                        <div class="confidence-item-label">NDF ì‹œê·¸ë„</div>
                        <div class="confidence-item-value ndf" id="ndfConfidenceDisplay">75%</div>
                    </div>
                    <div class="confidence-item">
                        <div class="confidence-item-label">AI ì°¨íŠ¸</div>
                        <div class="confidence-item-value ai" id="chartConfidenceDisplay">80%</div>
                    </div>
                </div>
            </div>
            
            <!-- AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸ (AI ì°¨íŠ¸ ë¶„ì„ ì‹œì—ë§Œ) -->
            <div class="ai-result-box" id="aiResultBox" style="display: none;">
                <h3>ğŸ¤– AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸</h3>
                <div class="ai-insight">
                    <div class="ai-insight-title">ğŸ“Š íŒ¨í„´ ë¶„ì„</div>
                    <div class="ai-insight-text" id="aiPatternInsight">AIê°€ ê°ì§€í•œ íŒ¨í„´ ë¶„ì„ ê²°ê³¼</div>
                </div>
                <div class="ai-insight">
                    <div class="ai-insight-title">ğŸ“ˆ ì¶”ì„¸ íŒë‹¨</div>
                    <div class="ai-insight-text" id="aiTrendInsight">AIê°€ íŒë‹¨í•œ í˜„ì¬ ì¶”ì„¸</div>
                </div>
                <div class="ai-insight">
                    <div class="ai-insight-title">ğŸ’¡ ë§¤ë§¤ ì œì•ˆ</div>
                    <div class="ai-insight-text" id="aiTradeInsight">AIê°€ ì œì•ˆí•˜ëŠ” ë§¤ë§¤ ì „ëµ</div>
                </div>
            </div>
            
            <!-- ì°¨íŠ¸ ë¶„ì„ ê²°ê³¼ -->
            <div class="chart-analysis-result" id="chartAnalysisResult" style="display: none;">
                <h3>ğŸ“ˆ ì°¨íŠ¸ ë ˆë²¨ ë¶„ì„</h3>
                
                <div class="pattern-detected" id="patternDetected">
                    <span class="pattern-tag bullish">ìƒìŠ¹ ì¶”ì„¸ì„ </span>
                </div>
                
                <div class="level-list">
                    <div class="level-item">
                        <span class="level-type">2ì°¨ ì €í•­ì„ </span>
                        <span class="level-value resistance" id="res2Value">1,485ì›</span>
                    </div>
                    <div class="level-item">
                        <span class="level-type">1ì°¨ ì €í•­ì„ </span>
                        <span class="level-value resistance" id="res1Value">1,470ì›</span>
                    </div>
                    <div class="level-item">
                        <span class="level-type">ğŸ“ í˜„ì¬ê°€</span>
                        <span class="level-value current" id="currentValue">1,455ì›</span>
                    </div>
                    <div class="level-item">
                        <span class="level-type">1ì°¨ ì§€ì§€ì„ </span>
                        <span class="level-value support" id="sup1Value">1,440ì›</span>
                    </div>
                    <div class="level-item">
                        <span class="level-type">2ì°¨ ì§€ì§€ì„ </span>
                        <span class="level-value support" id="sup2Value">1,425ì›</span>
                    </div>
                </div>
            </div>
            
            <!-- ê°€ê²© ê°€ì´ë“œ -->
            <div class="price-guide">
                <h3>ğŸ’° ì˜¤ëŠ˜ì˜ ë§¤ë§¤ ê°€ê²© ê°€ì´ë“œ</h3>
                
                <div class="price-item">
                    <div class="price-label">
                        <div class="price-icon entry">ğŸ¯</div>
                        <div class="price-text">
                            <div class="main-label">ì§„ì…ê°€</div>
                            <div class="sub-label">ì´ ê°€ê²©ì— ì‹œì‘í•˜ì„¸ìš”</div>
                            <div class="price-basis" id="entryBasis">
                                <span class="basis-tag ndf">NDF</span>
                            </div>
                        </div>
                    </div>
                    <div class="price-value">
                        <div class="amount" id="entryPrice">1,443.00ì›</div>
                        <div class="change" id="entryDesc">ì‹œì´ˆê°€ ì˜ˆìƒ</div>
                    </div>
                </div>
                
                <div class="price-item">
                    <div class="price-label">
                        <div class="price-icon target">ğŸ†</div>
                        <div class="price-text">
                            <div class="main-label">ëª©í‘œê°€</div>
                            <div class="sub-label">ì—¬ê¸°ì„œ ìˆ˜ìµ ì‹¤í˜„!</div>
                            <div class="price-basis" id="targetBasis">
                                <span class="basis-tag ndf">NDF</span>
                            </div>
                        </div>
                    </div>
                    <div class="price-value">
                        <div class="amount" id="targetPrice">1,458.00ì›</div>
                        <div class="change positive" id="targetChange">+15.00ì› (+1.04%)</div>
                    </div>
                </div>
                
                <div class="price-item">
                    <div class="price-label">
                        <div class="price-icon stop">ğŸ›‘</div>
                        <div class="price-text">
                            <div class="main-label">ì†ì ˆê°€</div>
                            <div class="sub-label">ì—¬ê¸°ì„œ ì†ì‹¤ ì œí•œ!</div>
                            <div class="price-basis" id="stopBasis">
                                <span class="basis-tag ndf">NDF</span>
                            </div>
                        </div>
                    </div>
                    <div class="price-value">
                        <div class="amount" id="stopPrice">1,432.00ì›</div>
                        <div class="change negative" id="stopChange">-11.00ì› (-0.76%)</div>
                    </div>
                </div>
            </div>
            
            <!-- ë¦¬ìŠ¤í¬/ë¦¬ì›Œë“œ ë¹„ìœ¨ -->
            <div class="rr-ratio">
                <h4>ğŸ“ ë¦¬ìŠ¤í¬ / ë¦¬ì›Œë“œ ë¹„ìœ¨</h4>
                <div class="rr-value" id="rrRatio">1 : 1.5</div>
                <div class="rr-desc" id="rrDesc">ì†ì‹¤ ëŒ€ë¹„ 1.5ë°° ìˆ˜ìµ ê¸°ëŒ€</div>
            </div>
            
            <!-- ìˆ˜ìµ/ì†ì‹¤ -->
            <div class="profit-loss-row">
                <div class="profit-card">
                    <h4>ğŸ“ˆ ì˜ˆìƒ ìµœëŒ€ ìˆ˜ìµ</h4>
                    <div class="profit-amount" id="maxProfit">+10,400ì›</div>
                    <div class="profit-desc" id="profitDesc">ëª©í‘œê°€ ë„ë‹¬ ì‹œ</div>
                </div>
                <div class="loss-card">
                    <h4>ğŸ“‰ ì˜ˆìƒ ìµœëŒ€ ì†ì‹¤</h4>
                    <div class="loss-amount" id="maxLoss">-7,600ì›</div>
                    <div class="loss-desc" id="lossDesc">ì†ì ˆê°€ ë„ë‹¬ ì‹œ</div>
                </div>
            </div>
            
            <!-- ì „ëµ -->
            <div class="strategy-section">
                <h3>ğŸ“‹ ì˜¤ëŠ˜ì˜ ì‹¤ì „ ì „ëµ</h3>
                
                <div class="strategy-item">
                    <div class="strategy-num">1</div>
                    <div class="strategy-content">
                        <div class="strategy-title" id="strat1Title">9ì‹œ ì¥ ì‹œì‘ ì§í›„ í™•ì¸</div>
                        <div class="strategy-desc" id="strat1Desc">ì‹œì´ˆê°€ê°€ ì˜ˆìƒëŒ€ë¡œ ì›€ì§ì´ëŠ”ì§€ í™•ì¸ í›„ ì§„ì…í•˜ì„¸ìš”.</div>
                    </div>
                </div>
                
                <div class="strategy-item">
                    <div class="strategy-num">2</div>
                    <div class="strategy-content">
                        <div class="strategy-title" id="strat2Title">ëª©í‘œê°€ ë„ë‹¬ ì‹œ ì ˆë°˜ ì •ë¦¬</div>
                        <div class="strategy-desc" id="strat2Desc">ìš•ì‹¬ ë¶€ë¦¬ì§€ ë§ê³  ì¼ë¶€ ìˆ˜ìµ ì‹¤í˜„í•˜ì„¸ìš”.</div>
                    </div>
                </div>
                
                <div class="strategy-item">
                    <div class="strategy-num">3</div>
                    <div class="strategy-content">
                        <div class="strategy-title" id="strat3Title">ì†ì ˆê°€ëŠ” ë°˜ë“œì‹œ ì§€í‚¤ê¸°</div>
                        <div class="strategy-desc" id="strat3Desc">ì†ì ˆê°€ ë„ë‹¬ ì‹œ ë¯¸ë ¨ ì—†ì´ ì •ë¦¬í•˜ì„¸ìš”.</div>
                    </div>
                </div>
            </div>
            
            <!-- ë°ì´í„° ìš”ì•½ -->
            <div class="data-summary">
                <h3>ğŸ“Š ë¶„ì„ ë°ì´í„°</h3>
                
                <div class="data-row">
                    <span class="data-label">ì „ì¼ ì¢…ê°€</span>
                    <span class="data-value" id="dataPrev">1,438.50ì›</span>
                </div>
                <div class="data-row">
                    <span class="data-label">í˜„ì¬ NDF</span>
                    <span class="data-value" id="dataNdf">1,455.20ì›</span>
                </div>
                <div class="data-row">
                    <span class="data-label">NDF ê°­</span>
                    <span class="data-value" id="dataGap">+16.70ì› (+1.16%)</span>
                </div>
                <div class="data-row">
                    <span class="data-label">ì˜ˆìƒ ë°©í–¥</span>
                    <span class="data-value" id="dataDir">ğŸ“ˆ ìƒìŠ¹</span>
                </div>
                <div class="data-row" id="dataTimeframeRow" style="display: none;">
                    <span class="data-label">ì°¨íŠ¸ íƒ€ì„í”„ë ˆì„</span>
                    <span class="data-value" id="dataTimeframe">4ì‹œê°„</span>
                </div>
                <div class="data-row" id="dataAiRow" style="display: none;">
                    <span class="data-label">AI ë¶„ì„</span>
                    <span class="data-value" style="color: #9b59b6;">ğŸ¤– GPT-4 Vision</span>
                </div>
            </div>
            
            <!-- ì£¼ì˜ì‚¬í•­ -->
            <div class="warning-box">
                <h4>âš ï¸ ë°˜ë“œì‹œ ì½ì–´ì£¼ì„¸ìš”!</h4>
                <ul class="warning-list">
                    <li>NDF ì‹œê·¸ë„ ì ì¤‘ë¥ ì€ ì•½ 65~75%ì…ë‹ˆë‹¤ (100%ê°€ ì•„ë‹™ë‹ˆë‹¤!)</li>
                    <li>AI ì°¨íŠ¸ ë¶„ì„ë„ í™•ë¥ ì  ë„êµ¬ì…ë‹ˆë‹¤. ë§¹ì‹ í•˜ì§€ ë§ˆì„¸ìš”!</li>
                    <li>ì¤‘ìš” ê²½ì œ ë‰´ìŠ¤ê°€ ìˆìœ¼ë©´ ì˜ˆì¸¡ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆì–´ìš”</li>
                    <li>ì†ì ˆê°€ëŠ” ë°˜ë“œì‹œ ì§€ì¼œì£¼ì„¸ìš”!</li>
                    <li>ì²˜ìŒì—ëŠ” ì†Œì•¡ìœ¼ë¡œ ì—°ìŠµí•˜ì„¸ìš”</li>
                </ul>
            </div>
            
            <!-- ë‹¤ì‹œí•˜ê¸° -->
            <button class="reset-btn" onclick="resetAll()">ğŸ”„ ë‹¤ì‹œ ë¶„ì„í•˜ê¸°</button>
        </div>
        
        <!-- í‘¸í„° -->
        <div class="footer">
            <p>ğŸ’± FX í™˜ìœ¨ AI ì°¨íŠ¸ ë¶„ì„ íŠ¸ë ˆì´ë”© ê°€ì´ë“œ</p>
            <p>GPT-4 Vision + NDF ë³µí•© ë¶„ì„</p>
            <p style="margin-top: 8px;">â€» íˆ¬ì ì±…ì„ì€ ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤</p>
        </div>
        
    </div>
    
    <script>
        // ==================== ì „ì—­ ë³€ìˆ˜ ====================
        let currentTab = 'ndf';
        let chartSource = 'investing';
        let selectedTimeframe = '4h';
        let uploadedChartData = null;
        let ndfAnalysisResult = null;
        let chartAnalysisResult = null;
        let aiAnalysisData = null;
        let apiKey = localStorage.getItem('openai_api_key') || '';
        
        // ==================== ì´ˆê¸°í™” ====================
        document.addEventListener('DOMContentLoaded', function() {
            updateClock();
            setInterval(updateClock, 1000);
            checkApiKey();
            loadSavedData();
        });
        
        // ==================== ì‹œê³„ ====================
        function updateClock() {
            const now = new Date();
            const options = { 
                timeZone: 'Asia/Seoul',
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: false
            };
            
            const formatter = new Intl.DateTimeFormat('ko-KR', options);
            const parts = formatter.formatToParts(now);
            
            let year, month, day, hour, minute, second;
            parts.forEach(part => {
                if (part.type === 'year') year = part.value;
                if (part.type === 'month') month = part.value;
                if (part.type === 'day') day = part.value;
                if (part.type === 'hour') hour = part.value;
                if (part.type === 'minute') minute = part.value;
                if (part.type === 'second') second = part.value;
            });
            
            document.getElementById('clock').textContent = `ğŸ‡°ğŸ‡· ${year}-${month}-${day} ${hour}:${minute}:${second}`;
            
            const hourNum = parseInt(hour);
            const seoulDate = new Date(now.toLocaleString('en-US', {timeZone: 'Asia/Seoul'}));
            const dayOfWeek = seoulDate.getDay();
            
            const statusEl = document.getElementById('marketStatus');
            
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                statusEl.textContent = 'ğŸ”´ ì£¼ë§ íœ´ì¥';
                statusEl.className = 'market-status closed';
            } else if (hourNum >= 6 && hourNum < 9) {
                statusEl.textContent = 'ğŸŸ¡ NDF í™•ì¸ ìµœì  ì‹œê°„!';
                statusEl.className = 'market-status optimal';
            } else if (hourNum >= 9 && hourNum < 16) {
                statusEl.textContent = 'ğŸŸ¢ í•œêµ­ ì‹œì¥ ê±°ë˜ ì¤‘';
                statusEl.className = 'market-status open';
            } else {
                statusEl.textContent = 'âšª í•œêµ­ ì‹œì¥ ë§ˆê°';
                statusEl.className = 'market-status closed';
            }
        }
        
        // ==================== API í‚¤ ê´€ë¦¬ ====================
        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key && key.startsWith('sk-')) {
                apiKey = key;
                localStorage.setItem('openai_api_key', key);
                checkApiKey();
                alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                alert('ì˜¬ë°”ë¥¸ OpenAI API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\n(sk-ë¡œ ì‹œì‘í•©ë‹ˆë‹¤)');
            }
        }
        
        function checkApiKey() {
            const statusEl = document.getElementById('apiStatus');
            if (apiKey && apiKey.startsWith('sk-')) {
                statusEl.className = 'api-status connected';
                statusEl.innerHTML = '<span>ğŸŸ¢</span><span>API ì—°ê²°ë¨ (í‚¤: ...'+apiKey.slice(-4)+')</span>';
                document.getElementById('apiKeyInput').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' + apiKey.slice(-4);
            } else {
                statusEl.className = 'api-status disconnected';
                statusEl.innerHTML = '<span>ğŸ”´</span><span>API í‚¤ ë¯¸ì„¤ì •</span>';
            }
        }
        
        // ==================== íƒ­ ì „í™˜ ====================
        function switchTab(tabName) {
            currentTab = tabName;
            
            document.querySelectorAll('.tab-btn').forEach((btn, idx) => {
                btn.classList.remove('active');
                if ((tabName === 'ndf' && idx === 0) || 
                    (tabName === 'chart' && idx === 1) || 
                    (tabName === 'combined' && idx === 2)) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            document.getElementById('resultArea').classList.remove('show');
        }
        
        // ==================== ë°ì´í„° ë§í¬ ì—´ê¸° ====================
        function openInvesting() {
            window.open('https://kr.investing.com/currencies/usd-krw', '_blank');
        }
        
        function openBarchart() {
            window.open('https://www.barchart.com/forex/quotes/%5EUSDKRW/forward-rates', '_blank');
        }
        
        // ==================== ìŠ¤í… ì²´í¬ ====================
        function checkStep1() {
            const val = document.getElementById('prevClose').value;
            const status = document.getElementById('step1Status');
            if (val && parseFloat(val) > 1000) {
                status.textContent = 'ì™„ë£Œ âœ“';
                status.className = 'step-status done';
            } else {
                status.textContent = 'ëŒ€ê¸°ì¤‘';
                status.className = 'step-status pending';
            }
            checkAnalyzeButton();
        }
        
        function checkStep2() {
            const val = document.getElementById('ndfRate').value;
            const status = document.getElementById('step2Status');
            if (val && parseFloat(val) > 1000) {
                status.textContent = 'ì™„ë£Œ âœ“';
                status.className = 'step-status done';
            } else {
                status.textContent = 'ëŒ€ê¸°ì¤‘';
                status.className = 'step-status pending';
            }
            checkAnalyzeButton();
        }
        
        function checkAnalyzeButton() {
            const prev = document.getElementById('prevClose').value;
            const ndf = document.getElementById('ndfRate').value;
            const btn = document.getElementById('analyzeBtnNdf');
            
            btn.disabled = !(prev && ndf && parseFloat(prev) > 1000 && parseFloat(ndf) > 1000);
        }
        
        // ==================== íˆ¬ìê¸ˆ ì„¤ì • ====================
        function setInvestment(amount, element) {
            document.getElementById('investment').value = amount;
            if (document.getElementById('investmentChart')) {
                document.getElementById('investmentChart').value = amount;
            }
            
            if (element) {
                const parent = element.closest('.invest-options');
                parent.querySelectorAll('.invest-option').forEach(btn => btn.classList.remove('active'));
                element.classList.add('active');
            }
        }
        
        // ==================== ì°¨íŠ¸ ì†ŒìŠ¤/íƒ€ì„í”„ë ˆì„ ====================
        function selectChartSource(source, element) {
            chartSource = source;
            document.querySelectorAll('.chart-source-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
        }
        
        function setTimeframe(tf, element) {
            selectedTimeframe = tf;
            document.querySelectorAll('.timeframe-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
        }
        
        // ==================== ì°¨íŠ¸ ì—…ë¡œë“œ ë° AI ë¶„ì„ ====================
        async function handleChartUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤!');
                return;
            }
            
            // API í‚¤ ì²´í¬
            if (!apiKey || !apiKey.startsWith('sk-')) {
                alert('AI ì°¨íŠ¸ ë¶„ì„ì„ ìœ„í•´ ë¨¼ì € OpenAI API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                uploadedChartData = e.target.result;
                
                // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                document.getElementById('chartPreview').src = uploadedChartData;
                document.getElementById('chartUploadArea').style.display = 'none';
                document.getElementById('chartPreviewContainer').style.display = 'block';
                
                // ìƒíƒœ ì—…ë°ì´íŠ¸
                document.getElementById('chartUploadStatus').textContent = 'ë¶„ì„ì¤‘...';
                document.getElementById('chartUploadStatus').className = 'step-status analyzing';
                
                // AI ë¶„ì„ ì‹œì‘
                await analyzeChartWithAI(uploadedChartData);
            };
            reader.readAsDataURL(file);
        }
        
        async function analyzeChartWithAI(imageData) {
            // AI ë¶„ì„ ìƒíƒœ í‘œì‹œ
            const statusEl = document.getElementById('aiAnalysisStatus');
            statusEl.classList.add('show');
            
            // ë‹¨ê³„ë³„ ì• ë‹ˆë©”ì´ì…˜
            const steps = ['aiStep1', 'aiStep2', 'aiStep3', 'aiStep4'];
            let currentStep = 0;
            
            const stepInterval = setInterval(() => {
                if (currentStep > 0) {
                    document.getElementById(steps[currentStep - 1]).classList.remove('active');
                    document.getElementById(steps[currentStep - 1]).classList.add('done');
                }
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('active');
                    currentStep++;
                }
            }, 800);
            
            try {
                // OpenAI API í˜¸ì¶œ
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            {
                                role: 'system',
                                content: `You are an expert forex chart analyst. Analyze the USD/KRW chart image and extract:
1. Current price (approximate)
2. Key resistance levels (2 levels if visible)
3. Key support levels (2 levels if visible)
4. RSI estimate (0-100, based on recent price action)
5. Overall trend (up/down/sideways)
6. Detected patterns (e.g., double top, head and shoulders, triangle, channel, etc.)
7. Brief analysis comment in Korean

Respond ONLY in this exact JSON format:
{
    "currentPrice": 1455.00,
    "resistance1": 1470.00,
    "resistance2": 1485.00,
    "support1": 1440.00,
    "support2": 1425.00,
    "rsi": 65,
    "trend": "up",
    "patterns": ["ìƒìŠ¹ ì¶”ì„¸ì„ ", "ê³¨ë“ í¬ë¡œìŠ¤"],
    "comment": "ì°¨íŠ¸ ë¶„ì„ ì½”ë©˜íŠ¸ë¥¼ í•œêµ­ì–´ë¡œ ì‘ì„±",
    "patternInsight": "ê°ì§€ëœ íŒ¨í„´ì— ëŒ€í•œ ì„¤ëª…",
    "trendInsight": "í˜„ì¬ ì¶”ì„¸ì— ëŒ€í•œ ì„¤ëª…",
    "tradeInsight": "ë§¤ë§¤ ì œì•ˆ"
}

If you cannot determine a value, use null. All prices should be realistic USD/KRW rates (typically 1100-1600).`
                            },
                            {
                                role: 'user',
                                content: [
                                    {
                                        type: 'text',
                                        text: 'Please analyze this USD/KRW forex chart and provide the technical analysis in the specified JSON format.'
                                    },
                                    {
                                        type: 'image_url',
                                        image_url: {
                                            url: imageData
                                        }
                                    }
                                ]
                            }
                        ],
                        max_tokens: 1000
                    })
                });
                
                clearInterval(stepInterval);
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // JSON íŒŒì‹±
                let analysisResult;
                try {
                    // JSON ë¶€ë¶„ë§Œ ì¶”ì¶œ
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        analysisResult = JSON.parse(jsonMatch[0]);
                    } else {
                        throw new Error('JSON not found in response');
                    }
                } catch (parseError) {
                    console.error('Parse error:', parseError);
                    // ê¸°ë³¸ê°’ ì‚¬ìš©
                    analysisResult = {
                        currentPrice: 1450,
                        resistance1: 1470,
                        resistance2: 1490,
                        support1: 1430,
                        support2: 1410,
                        rsi: 50,
                        trend: 'sideways',
                        patterns: ['ë¶„ì„ ì‹¤íŒ¨'],
                        comment: 'AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                        patternInsight: 'ë¶„ì„ ì‹¤íŒ¨',
                        trendInsight: 'ë¶„ì„ ì‹¤íŒ¨',
                        tradeInsight: 'ìˆ˜ë™ ë¶„ì„ì„ ê¶Œì¥í•©ë‹ˆë‹¤.'
                    };
                }
                
                // ê²°ê³¼ ì €ì¥
                aiAnalysisData = analysisResult;
                
                // ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ í‘œì‹œ
                steps.forEach(s => {
                    document.getElementById(s).classList.remove('active');
                    document.getElementById(s).classList.add('done');
                });
                
                // UI ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    statusEl.classList.remove('show');
                    applyAIResults(analysisResult);
                }, 500);
                
            } catch (error) {
                clearInterval(stepInterval);
                console.error('AI Analysis Error:', error);
                
                statusEl.classList.remove('show');
                document.getElementById('chartUploadStatus').textContent = 'ì˜¤ë¥˜';
                document.getElementById('chartUploadStatus').className = 'step-status pending';
                
                alert('AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n' + error.message + '\n\nìˆ˜ë™ìœ¼ë¡œ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                
                // ìˆ˜ë™ ì…ë ¥ ëª¨ë“œë¡œ ì „í™˜
                showManualInputMode();
            }
        }
        
        function applyAIResults(data) {
            // ì…ë ¥ í•„ë“œì— AI ê²°ê³¼ ì ìš©
            if (data.currentPrice) document.getElementById('chartCurrentPrice').value = data.currentPrice;
            if (data.resistance1) document.getElementById('chartResistance1').value = data.resistance1;
            if (data.resistance2) document.getElementById('chartResistance2').value = data.resistance2;
            if (data.support1) document.getElementById('chartSupport1').value = data.support1;
            if (data.support2) document.getElementById('chartSupport2').value = data.support2;
            if (data.rsi) document.getElementById('chartRsi').value = data.rsi;
            
            // ì¶”ì„¸
            const trendMap = { 'up': 'ìƒìŠ¹ ì¶”ì„¸ ğŸ“ˆ', 'down': 'í•˜ë½ ì¶”ì„¸ ğŸ“‰', 'sideways': 'íš¡ë³´ â¡ï¸' };
            document.getElementById('chartTrend').value = trendMap[data.trend] || data.trend;
            
            // íŒ¨í„´
            if (data.patterns && data.patterns.length > 0) {
                document.getElementById('chartPatterns').value = data.patterns.join(', ');
            }
            
            // AI ì½”ë©˜íŠ¸
            if (data.comment) {
                document.getElementById('aiCommentText').textContent = data.comment;
            }
            
            // ê²°ê³¼ ì¹´ë“œ í‘œì‹œ
            document.getElementById('aiResultCard').style.display = 'block';
            document.getElementById('manualEditCard').style.display = 'block';
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('chartUploadStatus').textContent = 'ì™„ë£Œ âœ“';
            document.getElementById('chartUploadStatus').className = 'step-status done';
            
            // ë¶„ì„ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('analyzeBtnChart').disabled = false;
            
            // ë³µí•© ë¶„ì„ ì²´í¬
            updateCombinedCheck();
        }
        
        function showManualInputMode() {
            document.getElementById('aiResultCard').style.display = 'block';
            document.getElementById('manualEditCard').style.display = 'none';
            
            // readonly í•´ì œ
            const inputs = document.querySelectorAll('#aiResultCard input');
            inputs.forEach(input => {
                input.removeAttribute('readonly');
                input.classList.remove('ai-value');
            });
            
            document.getElementById('aiCommentText').textContent = 'ìˆ˜ë™ ì…ë ¥ ëª¨ë“œì…ë‹ˆë‹¤. ì°¨íŠ¸ì—ì„œ í™•ì¸í•œ ê°’ì„ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        }
        
        function enableManualEdit() {
            const inputs = document.querySelectorAll('#aiResultCard input');
            inputs.forEach(input => {
                input.removeAttribute('readonly');
                input.style.borderColor = '#00d4ff';
            });
            
            document.getElementById('manualEditCard').innerHTML = `
                <div class="step-header">
                    <div class="step-number chart">âœï¸</div>
                    <div class="step-title">
                        <h3>ìˆ˜ë™ ìˆ˜ì • ëª¨ë“œ</h3>
                        <p>ìœ„ í•„ë“œë¥¼ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ìš”</p>
                    </div>
                </div>
                <div class="help-text">
                    ğŸ’¡ AI ë¶„ì„ ê²°ê³¼ê°€ ì •í™•í•˜ì§€ ì•Šë‹¤ë©´ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”. ìˆ˜ì • í›„ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¶„ì„ì„ ì§„í–‰í•˜ì„¸ìš”.
                </div>
            `;
        }
        
        function removeChart() {
            uploadedChartData = null;
            aiAnalysisData = null;
            document.getElementById('chartUploadArea').style.display = 'block';
            document.getElementById('chartPreviewContainer').style.display = 'none';
            document.getElementById('chartFileInput').value = '';
            document.getElementById('chartUploadStatus').textContent = 'ëŒ€ê¸°ì¤‘';
            document.getElementById('chartUploadStatus').className = 'step-status pending';
            document.getElementById('aiResultCard').style.display = 'none';
            document.getElementById('manualEditCard').style.display = 'none';
            document.getElementById('analyzeBtnChart').disabled = true;
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            ['chartCurrentPrice', 'chartResistance1', 'chartResistance2', 'chartSupport1', 'chartSupport2', 'chartRsi', 'chartTrend', 'chartPatterns'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            
            updateCombinedCheck();
        }
        
        // ==================== ë³µí•© ë¶„ì„ ì²´í¬ ====================
        function updateCombinedCheck() {
            const ndfDone = ndfAnalysisResult !== null;
            const chartDone = chartAnalysisResult !== null || aiAnalysisData !== null;
            
            document.getElementById('ndfCheckIcon').textContent = ndfDone ? 'âœ…' : 'â¬œ';
            document.getElementById('chartCheckIcon').textContent = chartDone ? 'âœ…' : 'â¬œ';
            
            const btn = document.getElementById('analyzeBtnCombined');
            if (ndfDone && chartDone) {
                btn.disabled = false;
                btn.querySelector('.sub-text').textContent = 'ë‘ ë¶„ì„ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!';
            } else {
                btn.disabled = true;
                btn.querySelector('.sub-text').textContent = 'NDFì™€ AI ì°¨íŠ¸ ë¶„ì„ì„ ë¨¼ì € ì™„ë£Œí•˜ì„¸ìš”';
            }
        }
        
        // ==================== ë¡œë”© ====================
        function showLoading() {
            document.getElementById('loading').classList.add('show');
            document.getElementById('resultArea').classList.remove('show');
            
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`loadStep${i}`);
                step.classList.remove('active', 'done');
            }
            
            let currentStep = 0;
            const stepInterval = setInterval(() => {
                if (currentStep > 0) {
                    document.getElementById(`loadStep${currentStep}`).classList.remove('active');
                    document.getElementById(`loadStep${currentStep}`).classList.add('done');
                }
                currentStep++;
                if (currentStep <= 4) {
                    document.getElementById(`loadStep${currentStep}`).classList.add('active');
                } else {
                    clearInterval(stepInterval);
                }
            }, 400);
            
            return stepInterval;
        }
        
        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }
        
        // ==================== NDF ë¶„ì„ ====================
        function analyzeNdf() {
            const prevClose = parseFloat(document.getElementById('prevClose').value);
            const ndfRate = parseFloat(document.getElementById('ndfRate').value);
            const investment = parseFloat(document.getElementById('investment').value) || 1000000;
            
            if (isNaN(prevClose) || isNaN(ndfRate)) {
                alert('ì „ì¼ ì¢…ê°€ì™€ NDFë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            if (prevClose < 1000 || prevClose > 2000 || ndfRate < 1000 || ndfRate > 2000) {
                alert('í™˜ìœ¨ ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”!\n(ë³´í†µ 1,100~1,600ì› ì‚¬ì´ì…ë‹ˆë‹¤)');
                return;
            }
            
            const loadingInterval = showLoading();
            
            setTimeout(() => {
                clearInterval(loadingInterval);
                const result = runNdfAnalysis(prevClose, ndfRate, investment);
                ndfAnalysisResult = result;
                updateCombinedCheck();
                displayResult(result, 'ndf');
            }, 2000);
        }
        
        function runNdfAnalysis(prevClose, ndfRate, investment) {
            const gap = ndfRate - prevClose;
            const gapPct = (gap / prevClose) * 100;
            const absGap = Math.abs(gap);
            
            let signal, signalTitle, signalDesc, signalIcon, signalClass;
            let entryPrice, targetPrice, stopPrice;
            let strategies = [];
            
            if (gap > 2) {
                signal = 'SELL_KRW';
                signalClass = 'sell-krw';
                signalIcon = 'ğŸŸ¢';
                signalTitle = 'ì›í™” ë§¤ë„';
                signalDesc = 'ë‹¬ëŸ¬ë¥¼ ì‚¬ì„¸ìš”! í™˜ìœ¨ ìƒìŠ¹ ì˜ˆìƒ';
                
                entryPrice = prevClose + (gap * 0.4);
                targetPrice = ndfRate + (absGap * 0.15);
                stopPrice = prevClose - (absGap * 0.4);
                
                strategies = [
                    { title: '9ì‹œ ê°­ìƒìŠ¹ í™•ì¸ í›„ ì§„ì…', desc: 'ì‹œì´ˆê°€ê°€ ì „ì¼ì¢…ê°€ë³´ë‹¤ ë†’ìœ¼ë©´ ìƒìŠ¹ ì‹ í˜¸! ì²« 5ë¶„ í™•ì¸ í›„ ì§„ì…í•˜ì„¸ìš”.' },
                    { title: `ëª©í‘œê°€ ${targetPrice.toFixed(0)}ì›ì—ì„œ ì ˆë°˜ ì •ë¦¬`, desc: 'ìš•ì‹¬ ë¶€ë¦¬ì§€ ë§ê³  ëª©í‘œ ë„ë‹¬í•˜ë©´ 50%ëŠ” ìˆ˜ìµ ì‹¤í˜„í•˜ì„¸ìš”.' },
                    { title: `ì†ì ˆê°€ ${stopPrice.toFixed(0)}ì› ë°˜ë“œì‹œ ì¤€ìˆ˜`, desc: 'ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ í•˜ë½í•˜ë©´ ì†ì ˆê°€ì—ì„œ ë¬´ì¡°ê±´ ì •ë¦¬!' }
                ];
                
            } else if (gap < -2) {
                signal = 'BUY_KRW';
                signalClass = 'buy-krw';
                signalIcon = 'ğŸ”´';
                signalTitle = 'ì›í™” ë§¤ìˆ˜';
                signalDesc = 'ë‹¬ëŸ¬ë¥¼ íŒŒì„¸ìš”! í™˜ìœ¨ í•˜ë½ ì˜ˆìƒ';
                
                entryPrice = prevClose + (gap * 0.4);
                targetPrice = ndfRate - (absGap * 0.15);
                stopPrice = prevClose + (absGap * 0.4);
                
                strategies = [
                    { title: '9ì‹œ ê°­í•˜ë½ í™•ì¸ í›„ ì§„ì…', desc: 'ì‹œì´ˆê°€ê°€ ì „ì¼ì¢…ê°€ë³´ë‹¤ ë‚®ìœ¼ë©´ í•˜ë½ ì‹ í˜¸! ì²« 5ë¶„ í™•ì¸ í›„ ì§„ì…í•˜ì„¸ìš”.' },
                    { title: `ëª©í‘œê°€ ${targetPrice.toFixed(0)}ì›ì—ì„œ ì ˆë°˜ ì •ë¦¬`, desc: 'ìš•ì‹¬ ë¶€ë¦¬ì§€ ë§ê³  ëª©í‘œ ë„ë‹¬í•˜ë©´ 50%ëŠ” ìˆ˜ìµ ì‹¤í˜„í•˜ì„¸ìš”.' },
                    { title: `ì†ì ˆê°€ ${stopPrice.toFixed(0)}ì› ë°˜ë“œì‹œ ì¤€ìˆ˜`, desc: 'ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ ìƒìŠ¹í•˜ë©´ ì†ì ˆê°€ì—ì„œ ë¬´ì¡°ê±´ ì •ë¦¬!' }
                ];
                
            } else {
                signal = 'HOLD';
                signalClass = 'hold';
                signalIcon = 'ğŸŸ¡';
                signalTitle = 'ê´€ë§';
                signalDesc = 'ì˜¤ëŠ˜ì€ ì‰¬ì„¸ìš”! ë°©í–¥ì´ ë¶ˆë¶„ëª…í•´ìš”';
                
                entryPrice = prevClose;
                targetPrice = prevClose + 5;
                stopPrice = prevClose - 5;
                
                strategies = [
                    { title: 'ì˜¤ì „ ì¶”ì´ ë¨¼ì € ê´€ì°°', desc: 'NDF ê°­ì´ ì‘ì•„ì„œ ë°©í–¥ì´ ë¶ˆë¶„ëª…í•´ìš”. 9~10ì‹œ íë¦„ì„ ì§€ì¼œë³´ì„¸ìš”.' },
                    { title: 'ëª…í™•í•œ ë°©í–¥ ë‚˜ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸°', desc: 'í™•ì‹¤í•œ ì¶”ì„¸ê°€ ë³´ì´ë©´ ê·¸ë•Œ ì§„ì…í•´ë„ ëŠ¦ì§€ ì•Šì•„ìš”.' },
                    { title: 'ë¬´ë¦¬í•œ ì§„ì… ê¸ˆì§€', desc: 'ì‹œê·¸ë„ì´ ì•½í•  ë•Œ ì§„ì…í•˜ë©´ ì†ì‹¤ í™•ë¥ ì´ ë†’ì•„ìš”.' }
                ];
            }
            
            let confidence;
            if (absGap >= 15) confidence = Math.min(95, 75 + absGap * 0.5);
            else if (absGap >= 10) confidence = 65 + absGap * 0.5;
            else if (absGap >= 5) confidence = 45 + absGap * 1;
            else confidence = 25 + absGap * 2;
            
            return {
                type: 'ndf',
                signal, signalClass, signalIcon, signalTitle, signalDesc,
                entryPrice, targetPrice, stopPrice,
                strategies, confidence,
                prevClose, ndfRate, gap, gapPct, investment
            };
        }
        
        // ==================== AI ì°¨íŠ¸ ë¶„ì„ ì™„ë£Œ ====================
        function finalizeChartAnalysis() {
            const currentPrice = parseFloat(document.getElementById('chartCurrentPrice').value);
            const resistance1 = parseFloat(document.getElementById('chartResistance1').value);
            const resistance2 = parseFloat(document.getElementById('chartResistance2').value);
            const support1 = parseFloat(document.getElementById('chartSupport1').value);
            const support2 = parseFloat(document.getElementById('chartSupport2').value);
            const rsi = parseFloat(document.getElementById('chartRsi').value);
            const trendText = document.getElementById('chartTrend').value;
            const patternsText = document.getElementById('chartPatterns').value;
            const investment = parseFloat(document.getElementById('investmentChart').value) || 1000000;
            
            if (isNaN(currentPrice)) {
                alert('í˜„ì¬ê°€ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì°¨íŠ¸ë¥¼ ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            let trend = 'sideways';
            if (trendText.includes('ìƒìŠ¹')) trend = 'up';
            else if (trendText.includes('í•˜ë½')) trend = 'down';
            
            const loadingInterval = showLoading();
            
            setTimeout(() => {
                clearInterval(loadingInterval);
                const result = runChartAnalysis({
                    currentPrice, resistance1, resistance2, support1, support2,
                    rsi, trend, investment, timeframe: selectedTimeframe,
                    patterns: patternsText ? patternsText.split(',').map(p => p.trim()) : [],
                    aiData: aiAnalysisData
                });
                chartAnalysisResult = result;
                updateCombinedCheck();
                displayResult(result, 'chart');
            }, 1500);
        }
        
        function runChartAnalysis(data) {
            const { currentPrice, resistance1, resistance2, support1, support2, rsi, trend, investment, timeframe, patterns, aiData } = data;
            
            let patternList = [];
            let signal, signalTitle, signalDesc, signalIcon, signalClass;
            let entryPrice, targetPrice, stopPrice;
            let confidence = 50;
            let strategies = [];
            
            // íŒ¨í„´ ì„¤ì •
            if (patterns && patterns.length > 0) {
                patterns.forEach(p => {
                    const lower = p.toLowerCase();
                    if (lower.includes('ìƒìŠ¹') || lower.includes('ê³¨ë“ ') || lower.includes('ì§€ì§€')) {
                        patternList.push({ name: p, type: 'bullish' });
                    } else if (lower.includes('í•˜ë½') || lower.includes('ë°ë“œ') || lower.includes('ì €í•­')) {
                        patternList.push({ name: p, type: 'bearish' });
                    } else {
                        patternList.push({ name: p, type: 'neutral' });
                    }
                });
            }
            
            // RSI ë¶„ì„
            if (!isNaN(rsi)) {
                if (rsi >= 70) {
                    patternList.push({ name: 'RSI ê³¼ë§¤ìˆ˜', type: 'bearish' });
                    confidence -= 10;
                } else if (rsi <= 30) {
                    patternList.push({ name: 'RSI ê³¼ë§¤ë„', type: 'bullish' });
                    confidence += 10;
                }
            }
            
            // ì¶”ì„¸ ë¶„ì„
            if (trend === 'up') {
                confidence += 15;
            } else if (trend === 'down') {
                confidence += 15;
            }
            
            const bullishPatterns = patternList.filter(p => p.type === 'bullish').length;
            const bearishPatterns = patternList.filter(p => p.type === 'bearish').length;
            
            if (bullishPatterns > bearishPatterns || trend === 'up') {
                signal = 'SELL_KRW';
                signalClass = 'sell-krw';
                signalIcon = 'ğŸŸ¢';
                signalTitle = 'ì›í™” ë§¤ë„';
                signalDesc = 'ğŸ¤– AI ë¶„ì„: ìƒìŠ¹ íŒ¨í„´ ê°ì§€! ë‹¬ëŸ¬ ë§¤ìˆ˜ ê³ ë ¤';
                
                entryPrice = currentPrice;
                targetPrice = !isNaN(resistance1) ? resistance1 : currentPrice * 1.01;
                stopPrice = !isNaN(support1) ? support1 : currentPrice * 0.995;
                
                confidence += 10;
                
                strategies = [
                    { title: 'í˜„ì¬ê°€ ê·¼ì²˜ì—ì„œ ë¶„í•  ì§„ì…', desc: `AIê°€ ë¶„ì„í•œ ${currentPrice.toFixed(0)}ì› ë¶€ê·¼ì—ì„œ 2~3íšŒ ë¶„í•  ë§¤ìˆ˜í•˜ì„¸ìš”.` },
                    { title: `1ì°¨ ì €í•­ì„  ${(resistance1 || targetPrice).toFixed(0)}ì›ì—ì„œ ì ˆë°˜ ì •ë¦¬`, desc: 'AIê°€ ê°ì§€í•œ ì €í•­ì„ ì—ì„œ ì¼ë¶€ ìˆ˜ìµ ì‹¤í˜„í•˜ì„¸ìš”.' },
                    { title: `ì§€ì§€ì„  ${(support1 || stopPrice).toFixed(0)}ì› ì´íƒˆ ì‹œ ì†ì ˆ`, desc: 'AIê°€ ê°ì§€í•œ ì§€ì§€ì„  ì•„ë˜ë¡œ ë‚´ë ¤ê°€ë©´ ì†ì ˆ!' }
                ];
                
            } else if (bearishPatterns > bullishPatterns || trend === 'down') {
                signal = 'BUY_KRW';
                signalClass = 'buy-krw';
                signalIcon = 'ğŸ”´';
                signalTitle = 'ì›í™” ë§¤ìˆ˜';
                signalDesc = 'ğŸ¤– AI ë¶„ì„: í•˜ë½ íŒ¨í„´ ê°ì§€! ë‹¬ëŸ¬ ë§¤ë„ ê³ ë ¤';
                
                entryPrice = currentPrice;
                targetPrice = !isNaN(support1) ? support1 : currentPrice * 0.99;
                stopPrice = !isNaN(resistance1) ? resistance1 : currentPrice * 1.005;
                
                confidence += 10;
                
                strategies = [
                    { title: 'í˜„ì¬ê°€ ê·¼ì²˜ì—ì„œ ë¶„í•  ì§„ì…', desc: `AIê°€ ë¶„ì„í•œ ${currentPrice.toFixed(0)}ì› ë¶€ê·¼ì—ì„œ 2~3íšŒ ë¶„í•  ë§¤ë„í•˜ì„¸ìš”.` },
                    { title: `1ì°¨ ì§€ì§€ì„  ${(support1 || targetPrice).toFixed(0)}ì›ì—ì„œ ì ˆë°˜ ì •ë¦¬`, desc: 'AIê°€ ê°ì§€í•œ ì§€ì§€ì„ ì—ì„œ ì¼ë¶€ ìˆ˜ìµ ì‹¤í˜„í•˜ì„¸ìš”.' },
                    { title: `ì €í•­ì„  ${(resistance1 || stopPrice).toFixed(0)}ì› ëŒíŒŒ ì‹œ ì†ì ˆ`, desc: 'AIê°€ ê°ì§€í•œ ì €í•­ì„  ìœ„ë¡œ ì˜¬ë¼ê°€ë©´ ì†ì ˆ!' }
                ];
                
            } else {
                signal = 'HOLD';
                signalClass = 'hold';
                signalIcon = 'ğŸŸ¡';
                signalTitle = 'ê´€ë§';
                signalDesc = 'ğŸ¤– AI ë¶„ì„: íŒ¨í„´ì´ ë¶ˆë¶„ëª…í•´ìš”';
                
                entryPrice = currentPrice;
                targetPrice = currentPrice + 5;
                stopPrice = currentPrice - 5;
                
                strategies = [
                    { title: 'ëª…í™•í•œ ë°©í–¥ ëŒ€ê¸°', desc: 'AIê°€ ëª…í™•í•œ íŒ¨í„´ì„ ê°ì§€í•˜ì§€ ëª»í–ˆì–´ìš”. ì¶”ê°€ í™•ì¸ í•„ìš”!' },
                    { title: 'ê±°ë˜ëŸ‰ í™•ì¸', desc: 'ê±°ë˜ëŸ‰ ì¦ê°€ì™€ í•¨ê»˜ ë°©í–¥ì´ ë‚˜ì˜¤ë©´ ì‹ ë¢°ë„ê°€ ë†’ì•„ìš”.' },
                    { title: 'ë¬´ë¦¬í•œ ì§„ì… ê¸ˆì§€', desc: 'ë¶ˆë¶„ëª…í•œ ìƒí™©ì—ì„œëŠ” ì†ì‹¤ ê°€ëŠ¥ì„±ì´ ë†’ì•„ìš”.' }
                ];
            }
            
            confidence = Math.min(95, Math.max(25, confidence));
            
            return {
                type: 'chart',
                signal, signalClass, signalIcon, signalTitle, signalDesc,
                entryPrice, targetPrice, stopPrice,
                strategies, confidence,
                patterns: patternList,
                currentPrice, resistance1, resistance2, support1, support2,
                rsi, trend, investment, timeframe,
                aiData
            };
        }
        
        // ==================== ë³µí•© ë¶„ì„ ====================
        function analyzeCombined() {
            if (!ndfAnalysisResult) {
                alert('NDF ë¶„ì„ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            if (!chartAnalysisResult && !aiAnalysisData) {
                alert('AI ì°¨íŠ¸ ë¶„ì„ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            // ì°¨íŠ¸ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ìƒì„±
            if (!chartAnalysisResult && aiAnalysisData) {
                const investment = parseFloat(document.getElementById('investmentChart').value) || 1000000;
                chartAnalysisResult = runChartAnalysis({
                    currentPrice: aiAnalysisData.currentPrice,
                    resistance1: aiAnalysisData.resistance1,
                    resistance2: aiAnalysisData.resistance2,
                    support1: aiAnalysisData.support1,
                    support2: aiAnalysisData.support2,
                    rsi: aiAnalysisData.rsi,
                    trend: aiAnalysisData.trend,
                    investment,
                    timeframe: selectedTimeframe,
                    patterns: aiAnalysisData.patterns,
                    aiData: aiAnalysisData
                });
            }
            
            const loadingInterval = showLoading();